"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[565],{70565:(e,t,s)=>{s.r(t),s.d(t,{GeoprocessingAsync:()=>p});var a=s(68230),n=s(68831),i=s(47130),o=s(6641),u=s(27387),l=s(64678),r=s.n(l),c=s(35109),b=s(76780),d=s(68457);const f=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function g(e,t){let s;if(null!=e){for(const a in e)f(e,a)&&(void 0===s&&(s={}),s[a]=t(e[a],a));return s}}function j(e){return c.gu?"esriJobSucceeded"===e:"job-succeeded"===e}let p=class{async execute(e,t,a){var n=u.U.string("url",e.url,u.U.never),i=a.getOutSR(e.outSpatialReference),l=a.getOutSR(e.processSpatialReference);if(a=u.U.exists("arguments",e.arguments,{}),e=(0,d.Rw)(t.cancellationToken)?{signal:t.cancellationToken.signal}:void 0,!c.SH)return this.execute_tasksApi(n,i,l,a,e,t);const b=(await Promise.resolve().then(s.bind(s,84650))).default.submitJob;let f,g=await b(n,a,{outSpatialReference:i,processSpatialReference:l},e);if(l=g.waitForJobCompletion(),(0,d.Iz)(t,l),g=await l,j(g.jobStatus)){f={},e=(await this.getResultNames(g,e)).map((e=>g.fetchResultData(e).then((t=>f[e]=t.value))));const s=r().all(e);o.i.race([s,t.cancellationToken]).finally((function(){s.isPending()&&g.cancelJob(g.jobId)})),await s}return{id:g.jobId,status:g.jobStatus,results:f,messages:g.messages}}async getResultNames(e,t){const s=e.sourceUrl;var a=s.indexOf("?");let i=s,o="";return-1!==a&&(i=s.substring(0,a),o=s.substring(a)),o=o?`${o}&f=json`:"?f=json",e=`${i}/jobs/${e.jobId}${o}`,(t=null===(t=null==(t=await(0,n.default)(e,t))?void 0:t.data)||void 0===t?void 0:t.results)?Object.keys(t):void 0}async execute_tasksApi(e,t,a,i,u,l){const b=new(0,(await s.e(3889).then(s.t.bind(s,63889,23))).default)(e);b.outSpatialReference=t,b.processSpatialReference=a;let f=i=b.submitJob(i,u);return c.x_&&(i=await i,f=b.waitForJobCompletion(i.jobId,u)),(0,d.Iz)(l,f),(0,d.Qo)(f,(async e=>{if(j(e.jobStatus)){e.results||await(async(e,t,s)=>{var a=e.indexOf("?");let i=e,o="";-1!==a&&(i=e.substring(0,a),o=e.substring(a)),o=o?`${o}&f=json`:"?f=json",a=`${i}/jobs/${t.jobId}${o}`,(s=await(0,n.default)(a,s))&&s.data&&(t.results=s.data.results)})(b.url,e,u);const t=[],s=g(e.results,(function(s,a){return a=r().resolve(b.getResultData(e.jobId,a,u)),(0,d.Iz)(l,a),t.push(a),a})),a=r().all(t);return o.i.race([a,l.cancellationToken]).finally((function(){a.isPending()&&b.cancelJob(e.jobId)})),(0,d.Qo)(a,(function(){return{id:e.jobId,status:e.jobStatus,results:g(s,(e=>e.value().value)),messages:e.messages}}))}return{id:e.jobId,status:e.jobStatus,results:void 0,messages:e.messages}}))}};p.action="gcx:wf:arcgis::GeoprocessingAsync",p.suite="gcx:wf:builtin",p=(0,a.gn)([(0,i.QZ)(b.I)],p)}}]);
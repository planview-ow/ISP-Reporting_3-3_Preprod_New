System.register(["jimu-core","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/dynamic-url-editor"],(function(e,t){var s={},o={},a={},i={},r={},n={};return{setters:[function(e){s.AllDataSourceTypes=e.AllDataSourceTypes,s.Immutable=e.Immutable,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.expressionUtils=e.expressionUtils,s.getAppStore=e.getAppStore,s.jsx=e.jsx},function(e){o.builderAppSync=e.builderAppSync},function(e){a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection},function(e){i.AdvancedButtonGroup=e.AdvancedButtonGroup,i.Button=e.Button,i.Checkbox=e.Checkbox,i.Label=e.Label,i.Modal=e.Modal,i.ModalBody=e.ModalBody,i.ModalFooter=e.ModalFooter,i.NumericInput=e.NumericInput,i.Switch=e.Switch,i.TextArea=e.TextArea,i.TextInput=e.TextInput,i.defaultMessages=e.defaultMessages,i.richTextUtils=e.richTextUtils},function(e){r.DataSourceSelector=e.DataSourceSelector},function(e){n.DynamicUrlEditor=e.DynamicUrlEditor}],execute:function(){e((()=>{var e={79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="#000"></path></svg>'},48891:e=>{"use strict";e.exports=s},23137:e=>{"use strict";e.exports=o},30726:e=>{"use strict";e.exports=i},338:e=>{"use strict";e.exports=r},9689:e=>{"use strict";e.exports=n},77756:e=>{"use strict";e.exports=a}},t={};function l(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,l),a.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var s in t)l.o(t,s)&&!l.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var c={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(c),l.d(c,{default:()=>m});var e=l(48891),t=l(23137),s=l(77756),o=l(30726);const a={_widgetLabel:"Embed",websiteAddress:"Website address",code:"Code",codePlaceholder:"Paste the HTML code you want to embed.",embedBy:"Embed by",attributeHint:"URL from an attribute",expressionHint:"URL by an expression",autoRefresh:"Auto refresh",autoInterval:"Interval",autoUnit:"Minute",reloadSetting:"Do not reload iframe when URL changes",maxLimit:"Maximum character limit exceeded.",restrictWarningTitle:"Change is coming!",restrictWarningTips:"The Embed by Code feature will be restricted soon to support only limited HTML formats in newly created apps. We recommend hosting your website on a server and using Embed by URL directly. For more details, see {restrictBlogLinkTag}this blog{restrictBlogLinkTag}.",codeWarningTitle:"This embedded HTML code will go out of support soon.",codeWarningTips:"Please change to one of the {codeSupportedLinkTag}supported HTML formats{codeSupportedLinkTag} as soon as possible or host your website on a server and use Embed by URL directly.",moreDetails:"Check more details on the supported HTML formats {detailsFormatLinkTag}here{detailsFormatLinkTag}.",unsupportedAlert:"Unsupported HTML format. Please try again."};var i;!function(e){e.Url="url",e.Code="code"}(i||(i={}));var r=l(338),n=l(9689),d=l(79964),p=l.n(d);const u=t=>{const s=window.SVG,{className:o}=t,a=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(s[o[a]]=e[o[a]])}return s}(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return s?e.React.createElement(s,Object.assign({className:i,src:p()},a)):e.React.createElement("svg",Object.assign({className:i},a))},h=["Trial","Trial Developer","HUP Online Entitlements","Trial Press","Personal Use","Developer Subscription"],g=["Developer","Trial Developer","Developer Subscription"];class m extends e.React.PureComponent{constructor(s){var r,n,l;super(s),this.supportedDsTypes=(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer,e.AllDataSourceTypes.SceneLayer]),this.embedTypeChange=e=>{const{config:t}=this.props;e===i.Url&&this.setState({showCodeError:!1}),t.embedType!==e&&this.props.onSettingChange({id:this.props.id,config:t.set("embedType",e)})},this.checkURL=e=>{if(!e||""===e)return this.setState({urlError:""}),!0;if(!new RegExp("^(([h][t]{2}[p][s])?://)").test(e))return this.setState({urlError:this.formatMessage("httpsUrlMessage")}),!1;if(new RegExp("^(([h][t]{2}[p][s])?://localhost)").test(e))return this.setState({urlError:""}),!0;const t=e.indexOf(".");return t<0||t===e.length-1?(this.setState({urlError:this.formatMessage("invalidUrlMessage")}),!1):(this.setState({urlError:""}),!0)},this.embedCodeChangeRightAway=e=>{const{config:s,id:o}=this.props;if((null==e?void 0:e.length)>8192)return this.setState({showCodeError:!0}),void t.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:o,propKey:"codeLimitExceeded",value:!0});this.setState({showCodeError:!1}),t.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:o,propKey:"codeLimitExceeded",value:!1}),this.props.onSettingChange({config:s.set("embedCode",e),id:o})},this.formatMessage=(e,t)=>{const s=Object.assign({},a,o.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:s[e]},t)},this.onDataSourceChange=e=>{e&&this.props.onSettingChange({id:this.props.id,useDataSources:e})},this.onToggleUseDataEnabled=e=>{this.props.onSettingChange({id:this.props.id,useDataSourcesEnabled:e})},this.onSwitchChanged=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set(t,e)})},this.handleAutoInterval=e=>{const{config:t,id:s}=this.props;this.props.onSettingChange({id:s,config:t.set("autoInterval",e)})},this.labelChange=e=>{var t;const{config:s,id:o}=this.props,a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;this.props.onSettingChange({id:o,config:s.set("label",a)})},this.webAddressExpressionChange=t=>{const{config:s,onSettingChange:a,id:r,useDataSourcesEnabled:n,useDataSources:l}=this.props,{embedType:c}=s,d=/\<exp((?!\<exp).)+\<\/exp\>/gim,p=null==t?void 0:t.match(/\<urlsearch((?!\<urlsearch).)+\<\/urlsearch\>/gim),u=null==t?void 0:t.match(d),h=t&&t.replace(/<[^>]+>/g,"").replace(/(^\s*|\s*$)/g,"");(p||u)&&0===h.indexOf("{")||this.checkURL(h)?this.setState({showUrlError:!1}):this.setState({showUrlError:!0});const g=(e=>{let t=[];for(const s in e){const o=e[s],a=null==o?void 0:o.parts;null!=a&&(t=t.concat(a))}return t})(o.richTextUtils.getAllExpressions(t));let m;m=e.expressionUtils.getUseDataSourceFromExpParts(g,l);const x=e.expressionUtils.getUseDataSourcesWithoutFields(l);m=e.expressionUtils.mergeUseDataSources(x,m);const f=null==t?void 0:t.match(d),b=c===i.Url&&n&&(null==l?void 0:l.length)>0&&f;t&&a(b?{id:r,config:s.set("expression",t),useDataSources:m}:{id:r,config:s.set("expression",t).set("enableLabel",!1),useDataSources:m})},this.isUsedDataSource=()=>{const{useDataSources:e,useDataSourcesEnabled:t}=this.props;return t&&e&&e.length>0},this.hasExpressionTag=e=>null==e?void 0:e.match(/\<exp((?!\<exp).)+\<\/exp\>/gim),this.handleOk=()=>{if(this.checkBoxRef){const e=this.checkBoxRef.checked;localStorage.setItem(this.cacheKey,null==e?void 0:e.toString())}this.setState({confirmDialogOpen:!1})},this.showDialog=()=>{this.setState({confirmDialogOpen:!0,buttonShowDialog:!0})},this.onCheckBoxChange=e=>{const t=e.currentTarget.checked;this.setState({notShowAgainChecked:t})},this.getModalStyle=()=>e.css`
      .modal-body{
        overflow-y: auto;
        max-height: 360px;
        padding: 0;
      }
      .modal-content{
        width: auto;
        background: var(--white);
        padding: 30px;
        border: none;
      }
      .modal-footer{
        padding: 0;
        margin-top: 30px;
        .btn {
          min-width: 80px;
          + .btn {
            margin-left: 10px;
          }
        }
      }
      &.modal-dialog{
        width: auto;
      }

      .title-icon {
        padding: 0 6px;
      }
      .title-label {
        font-size: 1rem;
        color: var(--black);
      }

      .message {
        margin-left: 36px;
        margin-top: 1rem;
      }
    `;const c=(0,e.getAppStore)().getState();this.accountType=null===(n=null===(r=null==c?void 0:c.portalSelf)||void 0===r?void 0:r.subscriptionInfo)||void 0===n?void 0:n.type,this.cacheKey=`exb-${null===(l=null==c?void 0:c.appStateInBuilder)||void 0===l?void 0:l.appId}-embed-alert`,this.state={showUrlError:!1,urlError:"",isExpPopupOpen:!1,showCodeError:!1,confirmDialogOpen:!0,notShowAgainChecked:!1,buttonShowDialog:!1}}componentWillUnmount(){t.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"codeLimitExceeded",value:!1})}render(){const{showUrlError:t,urlError:a,showCodeError:l,confirmDialogOpen:c,notShowAgainChecked:d,buttonShowDialog:p}=this.state,{theme:m,useDataSources:x,config:f,useDataSourcesEnabled:b,id:S,selectWidgets:v}=this.props,{embedType:w,enableLabel:y,label:j}=f,C=w===i.Url&&b&&(null==x?void 0:x.length)>0&&this.hasExpressionTag(f.expression),T=h.includes(this.accountType)||g.includes(this.accountType),M="true"===localStorage.getItem(this.cacheKey),D=w===i.Code&&c&&(!M||p),k=this.formatMessage("restrictWarningTips",{restrictBlogLinkTag:"<restrictBlogLinkTag>"}).replace(/\<restrictBlogLinkTag\>(.+)\<restrictBlogLinkTag\>/,'<a target="_blank" style="text-decoration: none !important;" href=https://www.esri.com/arcgis-blog/products/experience-builder/announcements/compliance-requirements-on-embedded-content-by-code-in-arcgis-experience-builder/>$1</a>');return(0,e.jsx)("div",{css:(this.props.theme,e.css`
    label {
      cursor: pointer;
    }
    .embed-dynamic-con{
      z-index: 3;
      .ql-editor{
        min-height: 174px;
      }
    }
  `)},(0,e.jsx)("div",{className:"widget-iframe jimu-widget"},(0,e.jsx)("div",null,(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(s.SettingRow,{label:this.formatMessage("embedBy")}),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(o.AdvancedButtonGroup,{className:"w-100"},(0,e.jsx)(o.Button,{className:"w-50","aria-label":`${this.formatMessage("embedBy")} ${this.formatMessage("url")}`,active:w===i.Url,onClick:()=>this.embedTypeChange(i.Url)},this.formatMessage("url")),(0,e.jsx)(o.Button,{className:"w-50","aria-label":`${this.formatMessage("embedBy")} ${this.formatMessage("code")}`,active:w===i.Code,onClick:()=>this.embedTypeChange(i.Code),disabled:T},this.formatMessage("code")))),w===i.Url&&(0,e.jsx)(s.SettingRow,null,(0,e.jsx)("div",{className:"choose-ds w-100"},(0,e.jsx)(r.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.props.useDataSources,useDataSourcesEnabled:b,onToggleUseDataEnabled:this.onToggleUseDataEnabled,onChange:this.onDataSourceChange,widgetId:this.props.id}))),(0,e.jsx)(s.SettingRow,null,w===i.Url?(0,e.jsx)("div",{className:"d-flex flex-column w-100 embed-dynamic-con"},(0,e.jsx)(n.DynamicUrlEditor,{widgetId:S,useDataSourcesEnabled:b,useDataSources:x,selectWidgets:v,onChange:this.webAddressExpressionChange,value:f.expression}),t&&(0,e.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-between",style:{marginTop:"5px"}},(0,e.jsx)(u,{color:m.colors.danger}),(0,e.jsx)("div",{style:{width:"calc(100% - 20px)",margin:"0 4px",overflow:"hidden",textOverflow:"ellipsis",color:m.colors.danger}},a))):(0,e.jsx)("div",{className:"d-flex flex-column w-100"},(0,e.jsx)(o.TextArea,{height:300,className:"w-100",spellCheck:!1,placeholder:this.formatMessage("codePlaceholder"),defaultValue:f.embedCode||"",onAcceptValue:this.embedCodeChangeRightAway}),l&&(0,e.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-between",style:{marginTop:"5px"}},(0,e.jsx)(u,{color:m.colors.danger}),(0,e.jsx)("div",{style:{width:"calc(100% - 20px)",margin:"0 4px",overflow:"hidden",textOverflow:"ellipsis",color:m.colors.danger}},this.formatMessage("maxLimit"))))),C&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)("div",{className:"d-flex justify-content-between w-100"},(0,e.jsx)("label",{className:"w-75 text-truncate d-inline-block font-dark-600"},this.formatMessage("label")),(0,e.jsx)(o.Switch,{className:"can-x-switch",checked:y||!1,"data-key":"enableLabel",onChange:e=>{this.onSwitchChanged(e.target.checked,"enableLabel")},"aria-label":this.formatMessage("label")}))),y&&(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(o.TextInput,{type:"text",className:"w-100",value:j||"",onChange:this.labelChange}))),w===i.Code&&(0,e.jsx)(o.Button,{icon:!0,className:"mt-2 mb-1",type:"default",onClick:this.showDialog},(0,e.jsx)(u,{size:"l",color:"var(--warning-600)"})),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)("div",{className:"d-flex justify-content-between w-100"},(0,e.jsx)("label",{className:"w-75 text-truncate d-inline-block font-dark-600"},this.formatMessage("autoRefresh")),(0,e.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.autoRefresh||!1,"data-key":"autoRefresh",onChange:e=>{this.onSwitchChanged(e.target.checked,"autoRefresh")},"aria-label":this.formatMessage("autoRefresh")}))),f.autoRefresh&&(0,e.jsx)(s.SettingRow,{flow:"wrap",label:`${this.formatMessage("autoInterval")} (${this.formatMessage("autoUnit")})`},(0,e.jsx)(o.NumericInput,{size:"sm",style:{width:"100%"},value:f.autoInterval||1,precision:2,min:.2,max:1440,onChange:this.handleAutoInterval,"aria-label":`${this.formatMessage("autoInterval")} (${this.formatMessage("autoUnit")})`}))),D&&(0,e.jsx)(o.Modal,{isOpen:!0,centered:!0,css:this.getModalStyle()},(0,e.jsx)(o.ModalBody,null,(0,e.jsx)("div",{className:"d-flex align-items-start"},(0,e.jsx)("div",{className:"title-icon"},(0,e.jsx)(u,{size:"l",color:"var(--warning-600)"})),(0,e.jsx)("div",{className:"title-label"},this.formatMessage("restrictWarningTitle"))),(0,e.jsx)("div",{className:"message"},(0,e.jsx)("div",{className:"font-body2",css:e.css`
                        color: var(--dark-800);
                      `,dangerouslySetInnerHTML:{__html:k}}),!p&&(0,e.jsx)("div",{css:e.css`margin-top: 1.5rem;`},(0,e.jsx)(o.Label,{check:!0,className:"justify-content-start align-items-start",css:e.css`
                            color: var(--black);
                          `},(0,e.jsx)(o.Checkbox,{className:"cursor-pointer mr-2",checked:d,onChange:this.onCheckBoxChange,ref:e=>this.checkBoxRef=e}),this.formatMessage("dialogPreventDisplayAgainDefaultText"))))),(0,e.jsx)(o.ModalFooter,null,(0,e.jsx)(o.Button,{type:"primary",onClick:this.handleOk},this.formatMessage("ok")))))))}}m.mapExtraStateProps=(e,t)=>{var s,o;const a=e&&(null===(o=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appConfig)||void 0===o?void 0:o.widgets),i=[];if(a)for(const e in a){const s=a[e];"widgets/common/embed/"===s.uri&&s.id!==t.id&&i.push(s)}return{appConfig:e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig,selectWidgets:i}}})(),c})())}}}));